name: Build MyOS Kernel & ISO

# 觸發條件：當 push 或 pull request 到 main/master 分支時執行
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-os:
    runs-on: ubuntu-latest

    steps:
    # 1. 下載你的程式碼
    - name: Checkout Code
      uses: actions/checkout@v4

    # 2. 安裝編譯與打包工具
    # gcc-multilib: 用於 -m32 編譯 32 位元程式
    # xorriso: grub-mkrescue 製作 ISO 必備工具
    # grub-pc-bin: 包含製作 legacy BIOS boot ISO 所需的檔案
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential gcc-multilib grub-common xorriso grub-pc-bin

    # 3. 執行編譯 (使用你之前的 Makefile)
    - name: Compile and Link
      run: make

    # 4. 確認 ISO 是否產生 (除錯用)
    - name: Verify ISO
      run: ls -lh myos.iso

    # 5. 上傳 Artifact (讓你可以在 GitHub 網頁上下載編譯好的 ISO)
    - name: Upload ISO Artifact
      uses: actions/upload-artifact@v4
      with:
        name: myos-release-iso
        path: myos.iso
        retention-days: 5
        
